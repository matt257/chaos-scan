generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Scan {
  id                   String   @id @default(cuid())
  createdAt            DateTime @default(now()) @map("createdAt")
  status               String   @default("pending")
  warnings             Json     @default("[]")
  extractionConfidence String?  @map("extractionConfidence")

  uploads Upload[]
  facts   Fact[]

  @@map("Scan")
}

model Upload {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now()) @map("createdAt")
  scanId     String   @map("scanId")
  filename   String?
  mimeType   String?  @map("mimeType")
  sourceType String   @map("sourceType")
  rawText    String   @map("rawText") @db.Text

  scan Scan @relation(fields: [scanId], references: [id], onDelete: Cascade)

  @@map("Upload")
}

model Fact {
  id              String  @id @default(cuid())
  scanId          String  @map("scanId")
  factId          String  @map("factId")
  factType        String  @map("factType")
  entityName      String? @map("entityName")
  amountValue     Float?  @map("amountValue")
  amountCurrency  String? @map("amountCurrency")
  dateValue       String? @map("dateValue")
  dateType        String? @map("dateType")
  status          String
  recurrence      String
  sourceType      String  @map("sourceType")
  sourceReference String  @map("sourceReference")
  confidence      Float
  notes           String?

  scan Scan @relation(fields: [scanId], references: [id], onDelete: Cascade)

  @@index([scanId])
  @@map("Fact")
}
